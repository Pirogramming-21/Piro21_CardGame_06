{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="psa_container">
    <div class="current-player">현재 플레이어: {{ user.username }}</div>
    <div class="history-list">
        {% for game, attacker_name, defender_name in page_obj %}
        <div class="history-item">
            <div class="history-info">
                <span>{{ forloop.revcounter }}</span> - {{ attacker_name }} VS {{ defender_name }}
            </div>
            {% if attacker_name == user.username and not game.status %}
            <div class="progress-container">
                <span class="progress">진행중...</span>
                <button class="cancel-progress-btn">
                    <a href="{% url 'game:cancel' game.pk %}">게임취소</a>
                </button>
            </div>
            {% elif defender_name == user.username and not game.status %}
            <button class="counter-attack">
                <a href="{% url 'game:counter' game.id %}">CounterAttack</a>
            </button>
            {% else %}
            <div>결과:
                {% if game.winner == user.id %}
                🤭🤭 승리 🤭🤭
                {% elif game.winner == -1 %}
                🚩🚩 무승부 🚩🚩
                {% else %}
                🥹🥹 패배 🥹🥹
                {% endif %}
            </div>
            {% endif %}
            <button class="game-info-btn">
                <a href="{% url 'game:gameInfo' game.id %}">게임정보</a>
            </button>
        </div>
        {% endfor %}
    </div>

    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}">이전</a>
            {% endif %}

            <span class="current">
                페이지 {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">다음</a>
            {% endif %}
        </span>
    </div>

</div>
{% endblock %}
